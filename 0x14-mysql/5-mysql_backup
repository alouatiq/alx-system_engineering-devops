#!/usr/bin/env bash
# Script to dump all MySQL databases and compress them with today's date as filename

# Check usage
if [ "$#" -ne 1 ]; then
  echo "Usage: $0 <mysql_root_password>"
  exit 1
fi

MYSQL_ROOT_PASSWORD="$1"
BACKUP_FILE="backup.sql"
DATE_FORMAT="$(date '+%d-%m-%Y')"
TAR_FILE="${DATE_FORMAT}.tar.gz"

# Dump all databases into backup.sql
mysqldump -u root -p"${MYSQL_ROOT_PASSWORD}" --all-databases > "${BACKUP_FILE}"

# Create a compressed tar.gz file using day-month-year as filename
tar -czvf "${TAR_FILE}" "${BACKUP_FILE}"

# (Optional) Remove the uncompressed SQL dump to keep things tidy
rm -f "${BACKUP_FILE}"

echo "Backup created: ${TAR_FILE}"
