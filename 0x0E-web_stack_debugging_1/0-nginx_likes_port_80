#!/bin/bash
# Ensure Nginx is installed and running inside the Docker container

# Step 1: Start the container if it does not exist or is stopped
if ! docker ps --format '{{.Names}}' | grep -q "^nginx_debug_container$"; then
    echo "Starting Nginx container..."
    docker start nginx_debug_container 2>/dev/null || docker run -d --name nginx_debug_container -p 80:80 nginx
    sleep 3  # Wait for it to start
fi

# Step 2: Check if Nginx is running inside the container
if ! docker exec nginx_debug_container pgrep nginx > /dev/null; then
    echo "Nginx is not running inside the container. Restarting Nginx..."
    docker exec nginx_debug_container nginx
fi

# Step 3: Check if Nginx is listening on port 80 inside the container
if ! docker exec nginx_debug_container ss -tulnp | grep -q ":80"; then
    echo "Nginx is not listening on port 80 inside the container. Restarting..."
    docker restart nginx_debug_container
fi

echo "âœ… Nginx is running and listening on port 80 inside the container."
