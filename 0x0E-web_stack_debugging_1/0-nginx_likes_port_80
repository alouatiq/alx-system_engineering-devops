#!/usr/bin/env bash
# Ensure Nginx is installed, configured, and listening on port 80

# Start the container if it's not running
if ! docker ps --format '{{.Names}}' | grep -q '^nginx_debug_container$'; then
    echo "Starting nginx_debug_container..."
    docker start nginx_debug_container 2>/dev/null || docker run -d --name nginx_debug_container -p 80:80 nginx
    sleep 3  # Give some time for the container to start
fi

# Ensure Nginx is properly set up inside the container
docker exec nginx_debug_container bash -c "
if ! command -v nginx &> /dev/null; then
    apt update && apt install -y nginx
fi

mkdir -p /etc/nginx/sites-enabled

if [ ! -f /etc/nginx/sites-enabled/default ]; then
    echo 'Creating Nginx default configuration...'
    cat <<EOL > /etc/nginx/sites-enabled/default
server {
    listen 80 default_server;
    listen [::]:80 default_server;
    root /var/www/html;
    index index.html;
    server_name _;
    location / {
        return 200 'OK';
        add_header Content-Type text/plain;
    }
}
EOL
fi

service nginx restart
"
